set(PSPW_INCLUDES
${PROJECT_SOURCE_DIR}/src/nwxc
${PROJECT_SOURCE_DIR}/src/nwpw
${PROJECT_SOURCE_DIR}/src/nwpw/nwpwlib/include
${PROJECT_SOURCE_DIR}/src/nwpw/nwpwlib/utilities

${PROJECT_SOURCE_DIR}/src/nwpw/pspw
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lcao
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/water_pseudopotential
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/pspw_Q
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/pspw_Three
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/model_potential
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/model_charge
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/pspw_LJ
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/mmq
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/pspw_Pair
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/qmmm/switching_charge
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/cell_optimize
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/dplot
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/cpsd
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/analysis
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/analysis/APC
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/charge
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/cgsd
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/makepsi
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/hfx
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/psp
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/utilities
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/electron
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/psi
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/aorbs
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/sic
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/truncating_function
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/exchange-correlation
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/thermostats
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/Grsm_list
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/coulomb
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/ion
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/lib/ke
${PROJECT_SOURCE_DIR}/src/nwpw/pspw/kbpp

)

set(PSPW_SOURCE_FILES
./pspw_input.F
./lcao/lcao_generate_vlmatrix.F
./lcao/lcao_generate_smatrix.F
./lcao/lcao_wvfnc_bak.F
./lcao/lcaov1.F
./lcao/lcao_diis_dn.F
./lcao/lcao_init_dn.F
./lcao/lcao_write_matrix.F
./lcao/lcao_dnlist.F
./lcao/lcao_generate_vhxcmatrix.F
./lcao/lcao_mlist.F
./lcao/lcao_write_psi.F
./lcao/lcao_diis.F
./lcao/lcao_make_psi.F
./lcao/lcao_new_mix_dn.F
./lcao/lcao_generate_kematrix.F
./lcao/lcao_wvfnc.F
./lcao/lcao_new_dn.F
./lcao/lcao_generate_vnlmatrix.F
./water_pseudopotential/waterpsp.F
./water_pseudopotential/LJ_Ion.F
./water_pseudopotential/water_pseudopotential_input.F
./water_pseudopotential/BLCJ_SR.F
./water_pseudopotential/LJparam_Ion.F
./water_pseudopotential/BLCJ_LR.F
./water_pseudopotential/BLCJ_Coulomb.F
./water_pseudopotential/BLCJ_Intra.F
./water_pseudopotential/BLCJ_Inter.F
./water_pseudopotential/BLCJ_Polarization.F
./qmmm/pspw_qmmm.F
./qmmm/pspw_springs.F
./qmmm/pspw_qmmm_input.F
./qmmm/pspw_2qmmm.F
./qmmm/pspw_Q/pspw_Q.F
./qmmm/pspw_LJ/pspw_LJ.F
./qmmm/mmq/mmq.F
./qmmm/pspw_Pair/pspw_Pair.F
#./qmmm/pspw_Three/pspw_Three.F
#./qmmm/model_potential/model_potential.F
#./qmmm/model_charge/model_charge.F
#./qmmm/switching_charge/switching_charge.F
./cell_optimize/pspw_force_numerical.F
./cell_optimize/cell_optimize_input.F
./cell_optimize/stress_fd.F
./cell_optimize/cell_optimize.F
./cell_optimize/force_fd.F
./cell_optimize/update_unitcell.F
./cell_optimize/pspw_stress_numerical.F
./dplot/ELF.F
./dplot/pspw_dplot.F
./dplot/pspw_dplot_iteration.F
./dplot/Ursenbach_smoother.F
./dplot/pspw_dplot_input.F
./cpsd/inner_loop_qmmm_step.F
./cpsd/cpmdv5.F
./cpsd/inner_loop_md.F
./cpsd/psi_lmbda_omp.F
./cpsd/cpmd_input.F
./cpsd/mm_loop.F
./cpsd/cpmd_qmmm_step.F
#./cpsd/inner_loop_cprmd.F
./cpsd/cpmd_qmmm_start.F
./cpsd/pspw_et.F
./cpsd/inner_loop.F
./cpsd/dipole_motion.F
./cpsd/fei_output.F
./cpsd/cpsd_input.F
./cpsd/cpmd_qmmm_stop.F
./cpsd/mmsdv1.F
#./cpsd/cprmdv1.F
./cpsd/cpsdv5.F
./cpsd/psi_lmbda2.f
./cpsd/psi_lmbda3.f
./cpsd/psi_lmbda.f
./cpsd/psi_lmbda_paw.f
./cpsd/psi_lmbda_sic.f
./analysis/pspw_atom_analysis.F
./analysis/analysis_expansion_coef.F
./analysis/pspw_Lubin_water_analysis.F
./analysis/orb_pop_kawai.F
./analysis/analysis.F
./analysis/orb_pop_aorb.F
./analysis/analysis_input.F
./analysis/orb_pop.F
./analysis/orb.F
./analysis/APC/pspw_Efield_grad.F
./analysis/APC/util_sorteps.F
./analysis/APC/pspw_APC.F
./analysis/APC/pspw_Efield.F
./analysis/APC/util_diag_jacobi.F
./charge/pspw_charge.F
#./charge/pspw_cosmo.F
./cgsd/pspw_noit_energy.F
./cgsd/cgsd_excited.F
./cgsd/nominimize.F
./cgsd/bfgsminimize.F
./cgsd/bybminimize2.F
./cgsd/bfgsminimize3.F
./cgsd/bfgsminimize2.F
./cgsd/pspw_stress.F
./cgsd/cgminimize.F
./cgsd/bybminimize.F
./cgsd/cgoptimize1.F
./cgsd/cgsd_input.F
./cgsd/cgsd_noit_energy.F
./cgsd/pspw_gradient.F
./cgsd/cgminimize2.F
./cgsd/cgsd_oep_eigenvalues.F
./cgsd/cgmontecarlov1.F
./cgsd/pspw_energy.F
./cgsd/cgsdv5.F
./cgsd/mmmdv1.F
./cgsd/sdminimize.F
./cgsd/cgsd_energy.F
./cgsd/kp_structure.F
./cgsd/cgmdv5.F
./cgsd/pspw_bq_gradient.F
./cgsd/md_energy.F
./lib/psi/orthocheck.f
./makepsi/pspw_translate.F
./makepsi/v_wvfnc_init.F
./makepsi/wvfnc_init_input.F
./makepsi/expand_cell.F
./makepsi/wvfnc_expand_cell.F
./makepsi/wvfnc_expander.F
./makepsi/silvestrelli_overlap_old.F
./makepsi/wvfnc_adjust.F
./makepsi/silvestrelli_minimize_old.F
./makepsi/wvfnc_expander_input.F
./makepsi/pspw_wannier_input.F
./makepsi/silvestrelli_minimize.F
./makepsi/wvfnc_ionize.F
./makepsi/pspw_wannier.F
./makepsi/pspw_wannier_old.F
./makepsi/v_wvfnc_init_input.F
./makepsi/wvfnc_init.F
./makepsi/wvfnc_reformat.F
./makepsi/wvfnc_convert_restricted.F
./makepsi/v_wvfnc_new.F
./makepsi/band_reformat_c_wvfnc.F
./makepsi/silvestrelli_overlap.F
./makepsi/makenodefunctions.F
./makepsi/pspw_wannier2.F
./makepsi/wvfnc_new.F
./lib/hfx/pspw_hfx.F
./lib/hfx/pspw_hfx_localized.F
#./lib/psp/semicore_force_b.F
./lib/psp/semicore_force_a.F
./lib/psp/semicore.F
./lib/psp/paw.F
./lib/psp/semicore_force.F
./lib/psp/psp.F
./lib/psp/MOTION.F
./lib/psp/psp_stress.F
./lib/psp/psp_cmp_dE_Qlm.F
./lib/psp/psp_U.F
./lib/psp/psp_olddebug.F
./lib/psp/psp_ld.F
./lib/utilities/CIF_write.F
./lib/electron/psi_Hv4.F
./lib/electron/psi_H.F
./lib/electron/electron.F
./lib/psi/geodesic1.F
./lib/psi/psi.F
./lib/psi/psi_read.F
./lib/psi/dipole.F
./lib/psi/v_psi_write.F
./lib/psi/psi_write.F
./lib/psi/berry_phase_pol.F
./lib/psi/skew.F
./lib/psi/v_psi_read.F
./lib/psi/psi_spin2.F
./lib/psi/geodesic.F
./lib/psi/geodesic2.F
./lib/psi/psi_read_filename.F
./lib/psi/psi_write_filename.F
./lib/psi/psi_new.F
./lib/psi/v_psi_new.F
./lib/psi/psi_dmatrix.F
./lib/psi/psi_history.F
./lib/psi/Grassman.F
./lib/aorbs/aorbs.F
./lib/sic/pspw_sic.F
./lib/truncating_function/truncating_function.F
#./lib/exchange-correlation/blyp-eric.f
./lib/exchange-correlation/blyp.f
./lib/exchange-correlation/pbe96.f
./lib/exchange-correlation/pbesol.f
./lib/exchange-correlation/revpbe.f
./lib/exchange-correlation/hsepbe.F
./lib/exchange-correlation/b3lyp.F
./lib/exchange-correlation/v_exc.F
./lib/exchange-correlation/v_bwexc.F
./lib/exchange-correlation/v_bwexc_euv.F
./lib/exchange-correlation/bnl2007_x.F
./lib/exchange-correlation/v_mexc.F
./lib/exchange-correlation/v_bwexc_all.F
./lib/exchange-correlation/nwpw_meta_gga.F
#./lib/thermostats/nose-hoover.F
./lib/Grsm_list/pspw_rmmdiis.F
./lib/Grsm_list/pspw_lmbfgs2.F
./lib/Grsm_list/pspw_Grsm_list.F
./lib/Grsm_list/pspw_lmbfgs.F
./lib/Grsm_list/pspw_lmbfgs3.F
./lib/Grsm_list/pspw_diis.F
./lib/coulomb/coulomb2.F
./lib/coulomb/coulomb.F
./lib/coulomb/coulomb_screened.F
./lib/coulomb/coulomb_screened_small.F
./lib/ion/ion_ion.F
./lib/ke/ke.F
#./kbpp/psp.f
./kbpp/setup_kbpp.f
./kbpp/integrate_kbppv3d.f
./kbpp/integrate_kbppv3d_new.f
./kbpp/integrate_kbppv3e.f
./kbpp/integrate_kbppv3e_new.f
./kbpp/integrate_kbppv3e_ray.f
./kbpp/integrate_kbppv3.f
./kbpp/integrate_kbppv3_new.f
./kbpp/integrate_kbppv3_ray.f
./kbpp/integrate_stress_ray.F
./kbpp/integrate_e_stress_new.F
./kbpp/integrate_d_stress_new.F
./kbpp/kbpp_orb.F
./kbpp/kbppv3-stress.F
./kbpp/integrate_paw_ray.F
./kbpp/Tesseral.F
./kbpp/integrate_d_stress.F
./kbpp/integrate_kbpp_orb.F
./kbpp/kbpp_ray.F
./kbpp/kbppv3e_stress.F
./kbpp/kbppv3.F
./kbpp/psp_formatter.F
./kbpp/kbppv3e.F
./kbpp/integrate_pawppv1.F
./kbpp/HGH_nonlocal.F
./kbpp/integrate_stress.F
./kbpp/integrate_e_stress.F
./kbpp/aorbs_formatter.F
./kbpp/integrate_stress_new.F
./kbpp/psp_formatter_input.F
./kbpp/pawppv1.F
./kbpp/psp_stress_formatter.F
./kbpp/integrate_e_stress_ray.F
./kbpp/HGH_local.F
./kbpp/kbppv3d.F
./kbpp/hghppv1.F
./kbpp/kbppv3d_stress.F
)


add_library(pspw_un OBJECT ./task_pspw.F)
target_include_directories(pspw_un PUBLIC ${NWC_INCLUDES} ${PSPW_INCLUDES})
target_compile_definitions(pspw_un PUBLIC ${NWPW_COMPILE_DEFS})
target_compile_options(pspw_un PUBLIC ${NWCHEM_Fortran_COMPILE_FLAGS} ${NWCHEM_Fortran_DEBUG_FLAGS})


add_library(pspw STATIC ${PSPW_SOURCE_FILES} $<TARGET_OBJECTS:pspw_un>)
#add_dependencies(pspw ${NWC_DEPENDENCIES})
target_include_directories(pspw PUBLIC ${NWC_INCLUDES} ${PSPW_INCLUDES})
target_compile_definitions(pspw PUBLIC ${NWPW_COMPILE_DEFS})
target_compile_options(pspw PUBLIC ${NWCHEM_Fortran_COMPILE_FLAGS})
target_compile_options(pspw PUBLIC ${NWCHEM_Fortran_OPTIMIZE_FLAGS})
